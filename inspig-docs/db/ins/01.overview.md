# INS 리포트 시스템 개요

> 인사이트피그플랜 주간/월간/분기 리포트 생성 시스템

---

## 1. 시스템 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    Oracle Database                          │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────────┐ │
│  │ 원본 테이블  │───▶│ PL/SQL 집계 │───▶│ 리포트 테이블   │ │
│  │ TB_MODON    │    │ 프로시저    │    │ TS_INS_WEEK     │ │
│  │ TB_MODON_WK │    └─────────────┘    │ TS_INS_WEEK_SUB │ │
│  │ TB_GYOBAE.. │           ▲           └─────────────────┘ │
│  └─────────────┘           │                    │          │
│                    ┌───────┴───────┐            │          │
│                    │ DBMS_SCHEDULER │            │          │
│                    │ 매주 월 02:00  │            │          │
│                    └───────────────┘            │          │
└─────────────────────────────────────────────────┼──────────┘
                                                  │ SELECT
                                                  ▼
                                    ┌─────────────────────────┐
                                    │   inspig (NestJS+React) │
                                    │   리포트 조회/표시       │
                                    └─────────────────────────┘
```

---

## 2. 스케줄러 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                    DBMS_SCHEDULER JOB                           │
│  JOB_INS_WEEKLY_REPORT   - 매주 월요일 02:00 KST                 │
│  JOB_INS_MONTHLY_REPORT  - 매월 1일 03:00 KST (예정)             │
│  JOB_INS_QUARTER_REPORT  - 분기 첫날 04:00 KST (예정)            │
└─────────────────────────┬───────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SP_INS_WEEK_MAIN (메인)                       │
│  1. TS_INS_MASTER 생성                                          │
│  2. 대상 농장 조회 (TS_INS_SERVICE)                              │
│  3. 농장별 SP_INS_WEEK_FARM_PROCESS 호출                         │
│  4. 완료 상태 업데이트                                           │
└─────────────────────────┬───────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│              SP_INS_WEEK_FARM_PROCESS (농장별)                   │
├─────────────────────────────────────────────────────────────────┤
│  SP_INS_WEEK_MANAGE_SOW     관리대상 모돈                        │
│  SP_INS_WEEK_MODON_POPUP    모돈현황 팝업                        │
│  SP_INS_WEEK_GB_POPUP       교배 팝업 (예정)                     │
│  SP_INS_WEEK_BM_POPUP       분만 팝업 (예정)                     │
│  ...                                                             │
└─────────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TS_INS_JOB_LOG (실행 로그)                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 테이블 구조

### 3계층 구조

| 계층 | 테이블 | 설명 |
|------|--------|------|
| 1 | TS_INS_MASTER | 리포트 생성 마스터 (주/월/분기별) |
| 2 | TS_INS_WEEK | 농장별 요약 데이터 |
| 3 | TS_INS_WEEK_SUB | 팝업별 상세 데이터 (GUBUN으로 구분) |

### 공통 테이블

| 테이블 | 설명 |
|--------|------|
| TS_INS_SERVICE | 서비스 신청 농장 |
| TS_INS_JOB_LOG | 프로시저 실행 로그 |
| TS_INS_ACCESS_LOG | 사용자 접속 로그 |

---

## 4. 시간 원칙

| 구분 | 시간 기준 |
|------|----------|
| 저장 시간 | SYSDATE (서버시간/UTC) |
| 기준일 | P_DT_TO (리포트 종료일) |
| 주간 리포트 | 월요일 ~ 일요일 |

---

## 5. 명명 규칙

| 구분 | 접두어 | 예시 |
|------|--------|------|
| 통계 테이블 | TS_INS_ | TS_INS_WEEK |
| 프로시저 | SP_INS_ | SP_INS_WEEK_MAIN |
| 스케줄러 JOB | JOB_INS_ | JOB_INS_WEEKLY_REPORT |
| 시퀀스 | SEQ_TS_INS_ | SEQ_TS_INS_MASTER |

---

## 6. 폴더별 문서

### ins/ (공통)

| 파일 | 설명 |
|------|------|
| [01.overview.md](01.overview.md) | 시스템 개요 (이 문서) |
| [02.table.md](02.table.md) | 테이블 정의 + GUBUN 매핑 |

### ins/week/ (주간 리포트)

| 파일 | 설명 |
|------|------|
| [00.process.md](week/00.process.md) | 주간 프로세스 흐름 |
| [01.modon-popup.md](week/01.modon-popup.md) | 모돈현황 팝업 |

---

## 7. SQL 파일

### 공통

| 파일 | 설명 |
|------|------|
| [sql/ins/01_SEQUENCE.sql](../sql/ins/01_SEQUENCE.sql) | 시퀀스 |
| [sql/ins/11_SP_INS_COM_LOG.sql](../sql/ins/11_SP_INS_COM_LOG.sql) | 로그 프로시저 |

### 주간 리포트

| 파일 | 설명 |
|------|------|
| [sql/ins/week/01_SP_INS_WEEK_MAIN.sql](../sql/ins/week/01_SP_INS_WEEK_MAIN.sql) | 메인 프로시저 |
| [sql/ins/week/02_SP_INS_WEEK_MANAGE_SOW.sql](../sql/ins/week/02_SP_INS_WEEK_MANAGE_SOW.sql) | 관리대상 모돈 |
| [sql/ins/week/11_SP_INS_WEEK_MODON_POPUP.sql](../sql/ins/week/11_SP_INS_WEEK_MODON_POPUP.sql) | 모돈현황 팝업 |
| [sql/ins/week/99_JOB_INS_WEEKLY.sql](../sql/ins/week/99_JOB_INS_WEEKLY.sql) | 스케줄러 JOB |

---

## 8. 참조 문서

- [../ref/01.table.md](../ref/01.table.md) - 운영 테이블 (TB_MODON 등)
- [../ref/02.view.md](../ref/02.view.md) - 운영 뷰
- [../ref/03.function.md](../ref/03.function.md) - 운영 함수 (SF_GET_MODONGB_STATUS)
- [../ref/04.etl.md](../ref/04.etl.md) - ETL 통계 SQL
