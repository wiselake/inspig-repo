# 운영 테이블 참조

> INS SQL 작성 시 참조할 기존 운영 DB 테이블
> (2024년 12월 운영 DB 기준 추출)

---

## 1. 테이블 관계도

```
┌─────────────┐
│   TA_FARM   │ ─────────────────────────────────────────┐
│  (농장)     │                                           │
└──────┬──────┘                                           │
       │ 1:N                                              │
       ▼                                                  │
┌─────────────┐     ┌─────────────┐                      │
│  TA_MEMBER  │     │ TC_FARM_CONFIG│ ◀────────────────────┤
│   (회원)    │     │ (농가설정)   │                      │
└─────────────┘     └─────────────┘                      │
                                                          │
┌─────────────┐                                           │
│  TB_MODON   │ ◀─────────────────────────────────────────┘
│ (모돈마스터) │
└──────┬──────┘
       │ 1:N (FARM_NO, PIG_NO)
       │
       ├──────────────┬──────────────┬──────────────┬──────────────┐
       ▼              ▼              ▼              ▼              ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ TB_MODON_WK │ │  TB_GYOBAE  │ │  TB_BUNMAN  │ │    TB_EU    │ │   TB_SAGO   │
│ (작업이력)   │ │   (교배)    │ │   (분만)    │ │   (이유)    │ │ (임신사고)  │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
       │
       │ 1:N
       ▼
┌──────────────────┐
│TB_MODON_JADON_TRANS│
│   (포유자돈)       │
└──────────────────┘
```

---

## 2. 테이블 목록

| 테이블명 | 설명 |
|----------|------|
| TA_FARM | 농장정보 |
| TA_MEMBER | 회원정보 |
| TB_BUNMAN | 분만정보 |
| TB_EU | 이유정보 |
| TB_GYOBAE | 교배정보 |
| TB_MODON | 모돈정보 |
| TB_MODON_JADON_TRANS | 포유자돈정보 |
| TB_MODON_WK | 모돈 작업정보 |
| TB_SAGO | 임신사고정보 |
| TC_FARM_CONFIG | 농가설정정보 |
| TM_ETC_TRADE | 농장 거래내역 |
| TM_LPD_DATA | 도축정보 |
| TS_INS_JOB_LOG | 스케줄러 실행 로그 테이블 (6개월 보관) |
| TS_INS_MASTER | 리포트 생성 마스터 테이블 |
| TS_INS_WEEK | 주간 리포트 테이블 |
| TS_INS_WEEK_SUB | 리포트 상세 테이블 (팝업 데이터) |
| TM_WEATHER | 일별 날씨 (예보/실측) |
| TM_WEATHER_HOURLY | 시간별 날씨 (예보/실측) |
| TM_WEATHER_ASOS | ASOS 관측소 메타정보 (97개 관측소) |

---

## 3. 모돈 관련 테이블

### TB_MODON (모돈정보)

```
PK: FARM_NO, PIG_NO
FK: FARM_NO → TA_FARM.FARM_NO
조건: OUT_DT = TO_DATE('99991231','YYYYMMDD') → 살아있음
인덱스:
  - IDX_TB_MODON (FARM_NO, PIG_NO) - UNIQUE (PK)
  - IDX_TB_MODON_01 (FARM_NO, FARM_PIG_NO, SYS_NC00036$, USE_YN)
  - IDX_TB_MODON_02 (FARM_NO, HYULTONG_NO, SYS_NC00036$, USE_YN)
  - IDX_TB_MODON_03 (FARM_NO, PIG_NO, SYS_NC00036$, USE_YN)
  - IDX_TB_MODON_04 (FARM_NO, SYS_NC00035$, SYS_NC00036$, USE_YN)
  - IDX_TB_MODON_05 (FARM_NO)
  - IDX_TB_MODON_06 (FARM_NO, USE_YN)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| FARM_PIG_NO | VARCHAR2(40) | NOT NULL | 개체번호 |
| PUMJONG_CD | VARCHAR2(6) | | 품종코드 |
| IGAK_NO | VARCHAR2(40) | | 이각번호 |
| BIRTH_DT | DATE | NOT NULL | 출생일 |
| IN_DT | DATE | NOT NULL | 전입일 |
| IN_SANCHA | NUMBER | NOT NULL | 전입산차 |
| IN_GYOBAE_CNT | NUMBER | NOT NULL | 전입교배차수 |
| IN_KG | NUMBER(5,2) | | 전입체중 |
| IN_LOC_CD | NUMBER | | 전입장소 |
| STATUS_CD | VARCHAR2(6) | NOT NULL | 전입상태 (010001~010008) |
| LAST_WK_DT | DATE | | 최종작업일 |
| HYULTONG_NO | VARCHAR2(40) | | 혈통번호 |
| MO_PIG_NO | VARCHAR2(40) | | 모돈 개체번호 |
| UN_PIG_NO | VARCHAR2(40) | | 부돈 개체번호 |
| MO_HYUL_NO | VARCHAR2(40) | | 모돈 혈통번호 |
| UN_HYUL_NO | VARCHAR2(40) | | 부돈 혈통번호 |
| OUT_DT | DATE | NOT NULL | 도폐사일 (99991231=살아있음) |
| OUT_GUBUN_CD | VARCHAR2(6) | | 도폐사 구분코드 |
| OUT_REASON_CD | VARCHAR2(6) | | 도폐사 원인코드 |
| OUT_REASON_DETAIL | VARCHAR2(2000) | | 도폐사 사유 |
| OUT_KG | NUMBER(8,2) | | 판매체중 |
| RFID_NO | VARCHAR2(50) | | 전자이표번호 |
| PSS | CHAR(1) | | PSS |
| FAMILY_CD | VARCHAR2(6) | | 가계코드 |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | NOT NULL | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| MOBILE | VARCHAR2(1) | | 모바일 |
| MOBILE_DIE | VARCHAR2(1) | | 모바일(도폐사용) |
| LOG_UPT_ID_DIE | VARCHAR2(40) | | 수정자(도폐사용) |
| LOG_UPT_DT_DIE | DATE | | 수정일(도폐사용) |
| EKAPE_SOW_NO | VARCHAR2(12) | | 축평원 모돈번호 |
| MOVE_IN_GUBUN | VARCHAR2(2) | | 전입구분-CJ용 |
| MOVE_FARM_NO | NUMBER | | 전입출 농가코드 |
| MOVE_OUT_PIG_NO | NUMBER | | 전출 모돈번호 |

---

### TB_MODON_WK (모돈 작업정보)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
FK: FARM_NO, PIG_NO → TB_MODON
인덱스:
  - IDX_TB_MODON_WK (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE (PK)
  - IDX_TB_MODON_WK_01 (FARM_NO, PIG_NO, WK_DT, WK_GUBUN, SEQ, USE_YN)
  - IDX_TB_MODON_WK_02 (FARM_NO, PIG_NO, USE_YN, SEQ)
  - IDX_TB_MODON_WK_03 (FARM_NO, PIG_NO, WK_DATE, WK_GUBUN) - UNIQUE
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| WK_DT | VARCHAR2(8) | NOT NULL | 작업일자 YYYYMMDD (PK) |
| WK_GUBUN | CHAR(1) | NOT NULL | 작업구분 A/G/B/E/F/Z (PK) |
| WK_DATE | DATE | NOT NULL | 작업일 |
| SANCHA | NUMBER | NOT NULL | 산차 |
| GYOBAE_CNT | NUMBER | NOT NULL | 교배차수 |
| LOC_CD | NUMBER | | 돈방코드 |
| FW_NO | NUMBER | | 분만틀번호 |
| SAGO_GUBUN_CD | VARCHAR2(6) | | 임신사고 구분코드 |
| DAERI_YN | CHAR(1) | | 대리모여부 (Y/N) |
| SEQ | NUMBER | NOT NULL | 일련번호 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| AUTO_GB | VARCHAR2(1) | | 자동생성 구분 (A=전입, Z=도폐사) |
| MOBILE | VARCHAR2(1) | | 모바일 |
| EKAPE_IUFLAG | VARCHAR2(1) | | 축평원 (C=등록, U=수정, D=삭제) |
| EKAPE_WK_DT | VARCHAR2(8) | | 축평원 전송작업일자 |

---

### TB_GYOBAE (교배정보)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
인덱스:
  - IDX_TB_GYOBAE (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE (PK)
  - IDX_TB_GYOBAE_01 (FARM_NO, UNGDON_PIG_NO_1, UFARM_PIG_NO_1, USE_YN)
  - IDX_TB_GYOBAE_02 (FARM_NO, PIG_NO, SYS_NC00021$)
  - IDX_TB_GYOBAE_03 (FARM_NO, PIG_NO, SYS_NC00022$)
  - IDX_TB_GYOBAE_04 (FARM_NO, UNGDON_PIG_NO_2, UFARM_PIG_NO_2, USE_YN)
  - IDX_TB_GYOBAE_05 (FARM_NO, UNGDON_PIG_NO_3, UFARM_PIG_NO_3, USE_YN)
  - IDX_TB_GYOBAE_06 (FARM_NO, UFARM_PIG_NO_3, USE_YN)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| WK_DT | VARCHAR2(8) | NOT NULL | 작업일자 (PK) |
| WK_GUBUN | CHAR(1) | NOT NULL | 작업구분 'G' (PK) |
| METHOD_1 | VARCHAR2(6) | | 웅돈1회 교배방법 |
| METHOD_2 | VARCHAR2(6) | | 웅돈2회 교배방법 |
| METHOD_3 | VARCHAR2(6) | | 웅돈3회 교배방법 |
| UNGDON_PIG_NO_1 | NUMBER | | 웅돈1회 시스템번호 |
| UNGDON_PIG_NO_2 | NUMBER | | 웅돈2회 시스템번호 |
| UNGDON_PIG_NO_3 | NUMBER | | 웅돈3회 시스템번호 |
| UFARM_PIG_NO_1 | VARCHAR2(40) | | 웅돈1회 개체번호 |
| UFARM_PIG_NO_2 | VARCHAR2(40) | | 웅돈2회 개체번호 |
| UFARM_PIG_NO_3 | VARCHAR2(40) | | 웅돈3회 개체번호 |
| WK_PERSON_CD | VARCHAR2(6) | | 작업자 |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| MOBILE | VARCHAR2(1) | | 모바일 |

---

### TB_BUNMAN (분만정보)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
인덱스:
  - IDX_TB_BUNMAN (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE (PK)
  - IDX_TB_BUNMAN_01 (FARM_NO, WK_DT, WK_GUBUN, USE_YN)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| WK_DT | VARCHAR2(8) | NOT NULL | 작업일자 (PK) |
| WK_GUBUN | CHAR(1) | NOT NULL | 작업구분 'B' (PK) |
| SILSAN | NUMBER | | 실산 (총 생존두수) |
| SILSAN_AM | NUMBER | | 실산(암) |
| SILSAN_SU | NUMBER | | 실산(수) |
| SASAN | NUMBER | | 사산 |
| MILA | NUMBER | | 미라 |
| SAENGSI_KG | NUMBER(8,2) | | 생시체중 |
| BUNMAN_GUBUN_CD | VARCHAR2(6) | | 분만구분코드 |
| JD_IGAK_NO | VARCHAR2(40) | | 자돈이각번호(PIC용) |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| MOBILE | VARCHAR2(1) | | 모바일 |

---

### TB_EU (이유정보)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
인덱스:
  - IDX_TB_EU (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE (PK)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| WK_DT | VARCHAR2(8) | NOT NULL | 작업일자 (PK) |
| WK_GUBUN | CHAR(1) | NOT NULL | 작업구분 'E' (PK) |
| DUSU | NUMBER | | 두수(암) |
| DUSU_SU | NUMBER | | 두수(수) |
| ILRYUNG | NUMBER | | 일령 (포유일수) |
| TOTAL_KG | NUMBER(9,2) | | 총체중 |
| DAERI_YN | CHAR(1) | | 대리모여부 |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| MOBILE | VARCHAR2(1) | | 모바일 |

---

### TB_SAGO (임신사고정보)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
인덱스:
  - IDX_TB_SAGO (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE (PK)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 시스템번호 (PK) |
| WK_DT | VARCHAR2(8) | NOT NULL | 작업일자 (PK) |
| WK_GUBUN | CHAR(1) | NOT NULL | 작업구분 'F' (PK) |
| SAGO_GUBUN_CD | VARCHAR2(6) | | 임신사고 구분코드 (050001=재발, 050002=유산) |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | NOT NULL | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| MOBILE | VARCHAR2(1) | | 모바일 |

---

### TB_MODON_JADON_TRANS (포유자돈정보)

```
PK: FARM_NO, PIG_NO, SEQ
인덱스:
  - IDX_TB_MODON_JADON_TRANS (FARM_NO, PIG_NO, SEQ) - UNIQUE (PK)
  - IDX_MODON_JADON_TRANS_01 (FARM_NO, WK_DT, GUBUN_CD)
  - IDX_MODON_JADON_TRANS_02 (FARM_NO, PIG_NO, WK_DT, GUBUN_CD)
  - IDX_MODON_JADON_TRANS_03 (FARM_NO, SYS_NC00024$, GUBUN_CD, USE_YN)
  - IDX_TB_MODON_JADON_TRANS_01 (FARM_NO, PIG_NO, SANCHA)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| PIG_NO | NUMBER | NOT NULL | 모돈번호 (PK) |
| SEQ | NUMBER | NOT NULL | 일련번호 (PK) |
| SANCHA | NUMBER | | 산차 |
| GUBUN_CD | VARCHAR2(6) | | 구분코드 (160001=폐사, 160003=전입, 160004=전출) |
| SUB_GUBUN_CD | VARCHAR2(6) | | 상세작업구분코드 |
| WK_DT | DATE | | 작업일 ⚠️ **DATE 타입** |
| DUSU | NUMBER | | 두수(암) |
| DUSU_SU | NUMBER | | 두수(수) |
| ILRYUNG | NUMBER | | 일령 |
| TOTAL_KG | NUMBER(9,2) | | 총체중 |
| BUN_DT | DATE | | 분만일 ⚠️ **DATE 타입** |
| EU_DT | DATE | | 이유일 ⚠️ **DATE 타입** |
| IO_PIG_NO | NUMBER | | 보내거나 받은 모돈 시스템번호 |
| LOC_CD | NUMBER | | 돈방코드 |
| FW_NO | NUMBER | | 분만틀번호 |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | | 사용여부 |
| AUTO_GB | VARCHAR2(1) | | 자동생성 구분 (A=전입, Z=도폐사) |
| IO_SEQ | NUMBER | | 전입출 SEQ |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |

> ⚠️ **주의**: WK_DT, BUN_DT, EU_DT는 **DATE 타입**입니다. VARCHAR2(8)이 아닙니다!
> SQL에서 문자열 비교 시 반드시 `TO_CHAR(WK_DT, 'YYYYMMDD')` 형식으로 변환해야 합니다.

---

## 4. 농장/회원 테이블

### TA_FARM (농장정보)

```
PK: FARM_NO
인덱스:
  - IDX_TA_FARM (FARM_NO) - UNIQUE (PK)
  - IDX_TA_FARM_01 (ASOS_STN_ID)
  - IDX_TA_FARM_COMPANY_CD_SOLE_CD_AGENT_CD (COMPANY_CD, SOLE_CD, AGENT_CD)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| FARM_NM | VARCHAR2(100) | | 농가명 |
| ALIAS_FARM_NM | VARCHAR2(100) | | 별칭 농가명(다비에서 사용) |
| PRINCIPAL_NM | VARCHAR2(50) | | 대표자명 |
| SIDO_CD | VARCHAR2(6) | | 시도코드 |
| SIGUN_CD | VARCHAR2(6) | | 시군코드 |
| ADM_CD | VARCHAR2(10) | | 행정구역코드 |
| EMDNO | NUMBER | | 읍면동 일련번호 |
| RNMGTSN | VARCHAR2(26) | | 도로명코드 |
| ZIPCODE | VARCHAR2(7) | | 우편번호 |
| ADDR1 | VARCHAR2(500) | | 주소 |
| ADDR2 | VARCHAR2(500) | | 상세주소 |
| COMPANY_CD | VARCHAR2(6) | | 업체코드 |
| SOLE_CD | VARCHAR2(6) | | 총판코드 |
| AGENT_CD | VARCHAR2(6) | | 특약점코드 |
| GRP_CD | VARCHAR2(6) | | 그룹코드 |
| JONG_CD | VARCHAR2(6) | | 종돈장코드 |
| FARM_TYPE | VARCHAR2(6) | | 농가구분 |
| FOUNDATION | VARCHAR2(20) | | 사업자번호 |
| FOUNDATION_NM | VARCHAR2(100) | | 사업자등록증 파일명 |
| FOUNDATION_PATH | VARCHAR2(200) | | 사업자등록증 경로 |
| OFFICE_TEL | VARCHAR2(20) | | 사무실 전화번호 |
| FAX | VARCHAR2(20) | | 팩스번호 |
| MANAGER_INFO | VARCHAR2(500) | | 담당자 정보 |
| MAP_X | VARCHAR2(20) | | 맵정보X좌표 (레거시) |
| MAP_Y | VARCHAR2(20) | | 맵정보Y좌표 (레거시) |
| MAP_X_N | NUMBER(9,6) | | 경도 longitude (소수점 6자리) |
| MAP_Y_N | NUMBER(9,6) | | 위도 latitude (소수점 6자리) |
| WEATHER_NX | NUMBER | | 기상청 격자 X (폐기 예정 → WEATHER_NX_N 사용) |
| WEATHER_NY | NUMBER | | 기상청 격자 Y (폐기 예정 → WEATHER_NY_N 사용) |
| WEATHER_NX_N | NUMBER(4) | | 기상청 격자 X (정수 4자리) |
| WEATHER_NY_N | NUMBER(4) | | 기상청 격자 Y (정수 4자리) |
| ASOS_STN_ID | INTEGER | | ASOS 관측소 지점번호 (FK → TM_WEATHER_ASOS) |
| ASOS_STN_NM | VARCHAR2(50) | | ASOS 관측소명 (조회 편의용) |
| ASOS_DIST_KM | NUMBER(6,2) | | 농장에서 관측소까지 거리 (km) |
| CREATE_DT | DATE | | 전산가입일 |
| STOP_DT | VARCHAR2(8) | | 종단일자 |
| RESTART_DT | VARCHAR2(8) | | 재 시작일자 |
| CI_PATH | VARCHAR2(200) | | CI 경로 |
| CJ_CD | VARCHAR2(10) | | CJ 농장코드 |
| COMP_ACRONYM | VARCHAR2(20) | | 농가/거래처 약어코드(cj용) |
| FARM_ACRONYM_01 | VARCHAR2(20) | | 농가 약어코드 - 다비육종 |
| CONTRACK_NO | VARCHAR2(20) | | 계약번호 |
| CONTRACK_TARGET | VARCHAR2(6) | | 계약 주체(934) |
| BILL_DAY | NUMBER | | 정산 기준일 |
| EKAPE_NO | VARCHAR2(20) | | 축평원 연계번호 |
| ICT_YN | CHAR(1) | | ICT장비 연계여부 |
| KD_FILE_DOWNGB | VARCHAR2(6) | | 검정파일다운대상구분 |
| TEST_YN | CHAR(1) | | 테스트 여부(농가) |
| COUNTRY_CODE | VARCHAR2(10) | | 국가코드 |
| MONEY_SIGN | VARCHAR2(10) | | 통화기호 |
| MONEY_ALIGN | VARCHAR2(10) | | 통화정렬 |
| MONEY_1000SING | VARCHAR2(10) | | 통화천단위기호 |
| MONEY_DECIMALSING | VARCHAR2(10) | | 통화소숫점기호 |
| MONEY_DECIMALPOINT | NUMBER | | 통화소수점자릿수 |
| FEED_RATIO | NUMBER | | 경영비중 사료비비율(스마트팜) |
| ETC_FEED_CD | VARCHAR2(6) | | 비율구분코드(스마트팜) |
| INFO_JSON | CLOB | | 추가설정정보(JSON) |
| USE_YN | CHAR(1) | | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |

---

### TA_MEMBER (회원정보)

```
PK: MEMBER_ID
FK: FARM_NO → TA_FARM.FARM_NO
인덱스:
  - IDX_TA_MEMBER (MEMBER_ID) - UNIQUE (PK)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| MEMBER_ID | VARCHAR2(50) | NOT NULL | 회원아이디 (PK) |
| FARM_NO | NUMBER | | 농장번호 (FK) |
| COMPANY_CD | VARCHAR2(6) | | 업체코드 |
| SOLE_CD | VARCHAR2(6) | | 총판코드 |
| AGENT_CD | VARCHAR2(6) | | 특약점코드 |
| MEMBER_TYPE | VARCHAR2(6) | | 회원구분 |
| MEMBER_TYPE_D | VARCHAR2(6) | | 회원상세구분 |
| NAME | VARCHAR2(50) | | 사용자명 |
| PASSWORD | VARCHAR2(100) | | 비밀번호 (암호화) |
| PASSHINT_CD | VARCHAR2(6) | | 비밀번호 힌트코드 |
| PASSHINT_VAL | VARCHAR2(200) | | 비밀번호 힌트 값 |
| EMAIL | VARCHAR2(100) | | 이메일 |
| HP_NUM | VARCHAR2(20) | | 핸드폰번호 |
| HP_ID | VARCHAR2(100) | | 핸드폰고유아이디 |
| DEPARTMENT | VARCHAR2(100) | | 소속 |
| POSITION | VARCHAR2(50) | | 직급 |
| AUTHORITY_NO | NUMBER | | 권한일련번호 |
| USER_OK_CD | VARCHAR2(6) | | 회원승인코드 |
| LAST_DT | DATE | | 마지막접속일 |
| LASTCON_FARM_NO | NUMBER | | 마지막 접속 농가/업체 코드 |
| LOGINKEY | VARCHAR2(200) | | 로그인 인증키 |
| CLOUD_YN | CHAR(1) | | 클라우드확인제용 |
| BIGO | VARCHAR2(500) | | 비고 |
| LOGOUT_DT | DATE | | 탈퇴일 |
| USE_YN | CHAR(1) | | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| SMS_INSPIG_YN | CHAR(1) | | 인사이트피그 알림 수신여부 (Y/N) |
| SMS_INSPIG_SDT | VARCHAR2(8) | | 인사이트피그 알림 시작일 (YYYYMMDD) |
| SMS_INSPIG_EDT | VARCHAR2(8) | | 인사이트피그 알림 종료일 (YYYYMMDD) |

**인사이트피그 알림톡 발송 조건:**
- `SMS_INSPIG_YN = 'Y'`: 알림 수신 동의
- `SMS_INSPIG_SDT <= 발송일 <= SMS_INSPIG_EDT`: 알림 발송 기간 내
- `HP_NUM IS NOT NULL`: 휴대폰 번호 필수

---

## 5. 설정 테이블

### TC_FARM_CONFIG (농가설정정보)

```
PK: FARM_NO, CODE
인덱스:
  - IDX_TC_FARM_CONFIG (FARM_NO, CODE) - UNIQUE (PK)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| CODE | VARCHAR2(6) | NOT NULL | 코드번호 (PK) |
| CVALUE | VARCHAR2(100) | | 코드값 |
| DISPLAY_TYPE | VARCHAR2(6) | | 출력구분 |
| SORT_NO | NUMBER | | 정렬순번 |
| USE_YN | CHAR(1) | | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |

**주요 설정코드:**

| CODE | 설명 | 기본값 |
|------|------|--------|
| 901001 | 임신기간 | 114 |
| 901002 | 포유기간 | 21 |
| 901003 | 이유후대기 | 7 |

---

## 6. 출하/거래 데이터 테이블

### TM_ETC_TRADE (농장 거래내역)

```
PK: FARM_NO, SEQ
용도: 농장 거래내역 (비육돈매출, 사료구매 등)
ETL: 내농장단가 계산에 사용 (ACCOUNT_CD LIKE '511%')
인덱스:
  - IDX_TM_ETC_TRADE (FARM_NO, SEQ) - UNIQUE (PK)
  - IDX_TM_ETC_TRADE_01 (FARM_NO, FEED_CD, GRP_NO, GAIN_YN)
  - IDX_TM_ETC_TRADE_02 (FARM_NO, ARTICLE_CD, GRP_NO, GAIN_YN)
  - IDX_TM_ETC_TRADE_03 (FARM_NO, COMP_CD, FEED_CD, GAIN_YN)
  - IDX_TM_ETC_TRADE_04 (FARM_NO, COMP_CD, ARTICLE_CD, GAIN_YN)
  - IDX_TM_ETC_TRADE_05 (FARM_NO, WK_DT, GAIN_YN, COMP_CD, FEED_CD, ARTICLE_CD)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | INTEGER | NOT NULL | 농장번호 (PK) |
| SEQ | INTEGER | NOT NULL | 일련번호 (PK) |
| WK_DT | DATE | | 작업일자 |
| ACCOUNT_CD | VARCHAR2(6) | | 계정코드 (511%=비육돈매출) |
| SUB_GUBUN_CD | VARCHAR2(6) | | 상세작업구분코드 |
| FPER_PRICE | NUMBER(14,3) | | 단가 |
| TOTAL_PRICE | NUMBER(14,2) | | 총금액 |
| PRICE_CASH | NUMBER(14,2) | | 현금 |
| PRICE_NCASH | NUMBER(14,2) | | 외상 |
| UNIT | NUMBER | | 단위 |
| NET_KG | NUMBER(9,2) | | 지육체중(도체중) |
| TOTAL_KG | NUMBER(9,2) | | 총체중 |
| GRP_NO | INTEGER | | 그룹번호 |
| CK_USE_GUBUN_CD | VARCHAR2(6) | | 사료구분코드 |
| VIN_CD | VARCHAR2(6) | | 빈코드 |
| DRUG_SEQ | INTEGER | | |
| BUTCHERY_DT | DATE | | 도축일자 |
| VALIDITY_DT | DATE | | 유효기간 |
| BIGO | VARCHAR2(200) | | 비고 |
| USE_YN | CHAR(1) | | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |
| GAIN_YN | VARCHAR2(1) | | 입고기준 (B=비육사료급이, M=경영입고) |
| COMP_CD | INTEGER | | 거래처코드 |
| ARTICLE_CD | INTEGER | | 품목코드 |
| FEED_CD | INTEGER | | 사료명코드 |
| LOC_CD | INTEGER | | 장소코드 |
| AUTO_GB | VARCHAR2(6) | | 저장 출처 |
| G_SEQ | INTEGER | | 그룹번호일련번호 |
| IN_BIGO | VARCHAR2(100) | | 등록출처 비고 |
| MP_PIG_NO | INTEGER | | 모돈시스템번호 |
| MOBILE | VARCHAR2(1) | | 모바일 |

**ETL 사용 예시 (내농장단가 계산):**

```sql
-- 내농장단가 = SUM(TOTAL_PRICE) / SUM(TOTAL_KG)
-- WK_DT는 DATE 타입이므로 시간 포함 가능, +1로 종료일 당일 전체 포함
-- TOTAL_PRICE > 0: 금액이 0인 비정상 데이터 제외
SELECT ROUND(SUM(TOTAL_PRICE) / NULLIF(SUM(TOTAL_KG), 0), 0) AS FARM_PRICE
FROM TM_ETC_TRADE
WHERE FARM_NO = :farm_no
  AND USE_YN = 'Y'
  AND WK_DT >= TO_DATE(:dt_from, 'YYYYMMDD')
  AND WK_DT < TO_DATE(:dt_to, 'YYYYMMDD') + 1
  AND SUBSTR(ACCOUNT_CD, 1, 3) = '511'  -- 비육돈매출
  AND TOTAL_KG > 0
  AND TOTAL_PRICE > 0;
```

---

### TM_LPD_DATA (도축정보)

```
PK: FARM_NO, DOCHUK_DT, DOCHUK_NO, FACTORY_CD
인덱스:
  - IDX_TM_LPD_DATA_00 (FARM_NO, DOCHUK_DT, DOCHUK_NO, FACTORY_CD) - UNIQUE (PK)
  - IDX_TM_LPD_DATA_01 (FARM_NO, UPLOAD_KEY, LOG_UPT_ID)
  - IDX_TM_LPD_DATA_02 (FARM_NO, EKAPE_FARM_NO, EKAPE_ANIMAL_SEQ)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | NOT NULL | 농장번호 (PK) |
| DOCHUK_DT | VARCHAR2(10) | NOT NULL | 도축일 YYYY-MM-DD (PK) |
| DOCHUK_NO | VARCHAR2(50) | NOT NULL | 도체번호 (PK) |
| FACTORY_CD | VARCHAR2(20) | NOT NULL | 작업장명 (PK) |
| SEQ | NUMBER | | 일련번호 |
| NET_KG | NUMBER(8,2) | | 지육체중(도체중) |
| BACK_DEPTH | NUMBER(8,2) | | 등지방두께 |
| LOIN_DIAMETER | NUMBER(8,2) | | 등심직경 |
| MEAT_QUALITY | VARCHAR2(6) | | 육질(최종등급) 1+/1/2/등외 |
| SEX_GUBUN | VARCHAR2(10) | | 성별구분 |
| AU_PRICE | NUMBER(10,2) | | 경락가 |
| TRANSFERENCE | NUMBER(5,2) | | 수율 |
| DOCHUK_CLASS | VARCHAR2(10) | | 도체형태 |
| DOCHUK_METHOD | VARCHAR2(10) | | 판정방법 |
| MEAT_COLOR | VARCHAR2(10) | | 육색 |
| FAT_COLOR | VARCHAR2(10) | | 지방색 |
| MEAT_INTUITION | VARCHAR2(10) | | 육질-육조직감 |
| MEAT_FAT | VARCHAR2(10) | | 육질-지방질 |
| MEAT_DEPOSITION | VARCHAR2(10) | | 육질-지방침착 |
| BEEF | VARCHAR2(10) | | 외관-비육 |
| BONED | VARCHAR2(10) | | 외관-삼겹 |
| FAT_ADHESION | VARCHAR2(10) | | 외관-지방부착 |
| HANGMOK | VARCHAR2(10) | | 결함-항목 |
| DOWN | VARCHAR2(10) | | 결함-하향 |
| PSE | VARCHAR2(10) | | 등외번호 |
| UU_JUDGEMENT | VARCHAR2(10) | | 예비육질등급(1차등급) |
| OO_JUDGEMENT | VARCHAR2(10) | | 예비규격등급 |
| SHIP_BY | VARCHAR2(100) | | 출하자 |
| GRP_NO | NUMBER | | 그룹번호 |
| FARM_JADON_NO | NUMBER | | 자돈 시스템번호 |
| UPLOAD_KEY | VARCHAR2(100) | | 업로드 고유키 |
| IMPORT_GB | VARCHAR2(10) | | 데이터 생성구분 |
| EKAPE_FARM_NO | VARCHAR2(20) | | 축평원 농장식별번호 |
| EKAPE_ANIMAL_NO | VARCHAR2(20) | | 축평원 돼지이력번호 |
| EKAPE_ANIMAL_SEQ | NUMBER | | 축평원 돼지이력순번 |
| EKAPE_ABATT_CODE | VARCHAR2(20) | | 작업장(도축장)코드 |
| EKAPE_ISSUE_NO | VARCHAR2(50) | | 확인서발급번호 |
| EKAPE_ISSUE_DT | VARCHAR2(10) | | 확인서발급날짜 |
| USE_YN | CHAR(1) | | 사용여부 |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_INS_ID | VARCHAR2(40) | | 생성자 |
| LOG_UPT_DT | DATE | | 수정일자 |
| LOG_UPT_ID | VARCHAR2(40) | | 수정자 |

---

---

## 7. InsightPig 전용 테이블

InsightPig 리포트 시스템 전용 테이블(`TS_INS_*`)은 아래 문서를 참조하십시오.

- [INS 테이블 설계 및 정의](../ins/02.table.md)

---

## 8. 코드 참조

### 작업구분 (WK_GUBUN)

| 코드 | 설명 | 상세 테이블 | 상태변경 |
|------|------|-------------|----------|
| A | 전입 | - | → 010001 (후보돈) |
| G | 교배 | TB_GYOBAE | → 010002 (임신돈) |
| B | 분만 | TB_BUNMAN | → 010003 (포유돈) |
| E | 이유 | TB_EU | → 010005 (이유모돈) |
| F | 임신사고 | TB_SAGO | → 010006/010007 |
| Z | 도폐사 | - | → 010008 (도폐사돈) |

### 상태코드 (STATUS_CD)

| 코드 | 설명 | 조건 |
|------|------|------|
| 010001 | 후보돈 | 미교배, 전입 직후 |
| 010002 | 임신돈 | 교배 후 |
| 010003 | 포유돈 | 분만 후 |
| 010004 | 대리모돈 | DAERI_YN='Y' |
| 010005 | 이유모돈 | 이유 후 |
| 010006 | 재발돈 | 사고(재발) |
| 010007 | 유산돈 | 사고(유산) SAGO_GUBUN_CD='050002' |
| 010008 | 도폐사돈 | 도폐사/전출 |

### 사고구분 (SAGO_GUBUN_CD)

| 코드 | 설명 |
|------|------|
| 050001 | 재발 |
| 050002 | 유산 |

### 포유자돈 구분 (GUBUN_CD)

| 코드 | 설명 |
|------|------|
| 160001 | 폐사 |
| 160003 | 전입 |
| 160004 | 전출 |

---

## 9. 자주 사용하는 조인 패턴

### 모돈 현황 조회 (기준일 기준)

```sql
-- 기준일에 살아있는 모돈 + 마지막 작업
SELECT M.FARM_NO, M.PIG_NO, M.FARM_PIG_NO,
       W.WK_GUBUN, W.SANCHA, W.GYOBAE_CNT
FROM TB_MODON M
LEFT JOIN (
    SELECT FARM_NO, PIG_NO, WK_GUBUN, SANCHA, GYOBAE_CNT,
           ROW_NUMBER() OVER (
               PARTITION BY FARM_NO, PIG_NO
               ORDER BY WK_DATE DESC, SEQ DESC
           ) RN
    FROM TB_MODON_WK
    WHERE WK_DATE <= :P_BASE_DATE
      AND USE_YN = 'Y'
) W ON M.FARM_NO = W.FARM_NO
   AND M.PIG_NO = W.PIG_NO
   AND W.RN = 1
WHERE M.FARM_NO = :P_FARM_NO
  AND M.IN_DT <= :P_BASE_DATE
  AND M.OUT_DT > :P_BASE_DATE
  AND M.USE_YN = 'Y';
```

### 교배 상세 조회

```sql
SELECT W.*, G.METHOD_1, G.UNGDON_PIG_NO_1
FROM TB_MODON_WK W
JOIN TB_GYOBAE G ON W.FARM_NO = G.FARM_NO
                AND W.PIG_NO = G.PIG_NO
                AND W.WK_DT = G.WK_DT
                AND W.WK_GUBUN = G.WK_GUBUN
WHERE W.WK_GUBUN = 'G'
  AND W.USE_YN = 'Y'
  AND G.USE_YN = 'Y';
```

### 포유자돈 이동 조회 (DATE 타입 주의)

```sql
-- WK_DT, BUN_DT는 DATE 타입이므로 TO_CHAR 변환 필요
SELECT JT.FARM_NO, JT.PIG_NO,
       TO_CHAR(JT.WK_DT, 'YYYYMMDD') AS WK_DT,
       TO_CHAR(JT.BUN_DT, 'YYYYMMDD') AS BUN_DT,
       JT.GUBUN_CD, JT.DUSU, JT.DUSU_SU
FROM TB_MODON_JADON_TRANS JT
WHERE JT.FARM_NO = :P_FARM_NO
  AND JT.USE_YN = 'Y'
  AND TO_CHAR(JT.WK_DT, 'YYYYMMDD') BETWEEN :P_DT_FROM AND :P_DT_TO;
```

---

## 10. 테이블 데이터 건수

### 현재 운영 데이터 건수 (2024년 12월 기준)

| 테이블명 | 건수 | 설명 |
|----------|-----:|------|
| TA_FARM | 3,137 | 농장정보 |
| TA_MEMBER | 3,166 | 회원정보 |
| TB_MODON | 3,321,652 | 모돈정보 |
| TB_MODON_WK | 40,520,788 | 모돈 작업정보 |
| TB_GYOBAE | 14,901,563 | 교배정보 |
| TB_BUNMAN | 11,502,164 | 분만정보 |
| TB_EU | 11,399,639 | 이유정보 |
| TB_SAGO | 2,716,877 | 임신사고정보 |
| TB_MODON_JADON_TRANS | 10,021,310 | 포유자돈정보 |
| TC_FARM_CONFIG | 598,327 | 농가설정정보 |
| TM_LPD_DATA | 10,362,690 | 도축정보 |
| TS_INS_MASTER | 7 | 리포트 마스터 |
| TS_INS_WEEK | 35 | 주간 리포트 |
| TS_INS_WEEK_SUB | 1,578 | 리포트 상세 |
| TS_INS_JOB_LOG | 263 | 스케줄러 로그 |

### 전체 테이블 건수 확인 SQL

```sql
-- 모든 관련 테이블 건수 확인
SELECT 'TA_FARM' AS TABLE_NM, COUNT(*) AS CNT FROM TA_FARM
UNION ALL SELECT 'TA_MEMBER', COUNT(*) FROM TA_MEMBER
UNION ALL SELECT 'TB_MODON', COUNT(*) FROM TB_MODON
UNION ALL SELECT 'TB_MODON_WK', COUNT(*) FROM TB_MODON_WK
UNION ALL SELECT 'TB_GYOBAE', COUNT(*) FROM TB_GYOBAE
UNION ALL SELECT 'TB_BUNMAN', COUNT(*) FROM TB_BUNMAN
UNION ALL SELECT 'TB_EU', COUNT(*) FROM TB_EU
UNION ALL SELECT 'TB_SAGO', COUNT(*) FROM TB_SAGO
UNION ALL SELECT 'TB_MODON_JADON_TRANS', COUNT(*) FROM TB_MODON_JADON_TRANS
UNION ALL SELECT 'TC_FARM_CONFIG', COUNT(*) FROM TC_FARM_CONFIG
UNION ALL SELECT 'TM_LPD_DATA', COUNT(*) FROM TM_LPD_DATA
UNION ALL SELECT 'TS_INS_MASTER', COUNT(*) FROM TS_INS_MASTER
UNION ALL SELECT 'TS_INS_WEEK', COUNT(*) FROM TS_INS_WEEK
UNION ALL SELECT 'TS_INS_WEEK_SUB', COUNT(*) FROM TS_INS_WEEK_SUB
UNION ALL SELECT 'TS_INS_JOB_LOG', COUNT(*) FROM TS_INS_JOB_LOG
ORDER BY TABLE_NM;
```

### 특정 농장 데이터 건수 확인

```sql
-- 특정 농장의 모든 관련 데이터 건수
SELECT 'TB_MODON' AS TABLE_NM, COUNT(*) AS CNT FROM TB_MODON WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_MODON_WK', COUNT(*) FROM TB_MODON_WK WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_GYOBAE', COUNT(*) FROM TB_GYOBAE WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_BUNMAN', COUNT(*) FROM TB_BUNMAN WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_EU', COUNT(*) FROM TB_EU WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_SAGO', COUNT(*) FROM TB_SAGO WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_MODON_JADON_TRANS', COUNT(*) FROM TB_MODON_JADON_TRANS WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TC_FARM_CONFIG', COUNT(*) FROM TC_FARM_CONFIG WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TM_LPD_DATA', COUNT(*) FROM TM_LPD_DATA WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TS_INS_WEEK', COUNT(*) FROM TS_INS_WEEK WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TS_INS_WEEK_SUB', COUNT(*) FROM TS_INS_WEEK_SUB WHERE FARM_NO = :P_FARM_NO
ORDER BY TABLE_NM;
```

### 테이블 구조 추출 SQL

```sql
-- 1. 테이블 컬럼 정보 추출
SELECT
    T.TABLE_NAME,
    C.COLUMN_NAME,
    C.DATA_TYPE ||
        CASE
            WHEN C.DATA_TYPE IN ('VARCHAR2', 'CHAR', 'NVARCHAR2') THEN '(' || C.DATA_LENGTH || ')'
            WHEN C.DATA_TYPE = 'NUMBER' AND C.DATA_PRECISION IS NOT NULL
                THEN '(' || C.DATA_PRECISION || DECODE(C.DATA_SCALE, 0, '', ',' || C.DATA_SCALE) || ')'
            ELSE ''
        END AS DATA_TYPE,
    DECODE(C.NULLABLE, 'N', 'NOT NULL', '') AS NULLABLE,
    C.COLUMN_ID
FROM USER_TABLES T
JOIN USER_TAB_COLUMNS C ON T.TABLE_NAME = C.TABLE_NAME
WHERE T.TABLE_NAME IN (
    'TA_FARM', 'TA_MEMBER',
    'TB_MODON', 'TB_MODON_WK', 'TB_GYOBAE', 'TB_BUNMAN', 'TB_EU', 'TB_SAGO', 'TB_MODON_JADON_TRANS',
    'TC_FARM_CONFIG', 'TM_LPD_DATA',
    'TS_INS_MASTER', 'TS_INS_WEEK', 'TS_INS_WEEK_SUB', 'TS_INS_JOB_LOG'
)
ORDER BY T.TABLE_NAME, C.COLUMN_ID;

-- 2. 인덱스 정보 추출
SELECT
    I.TABLE_NAME,
    I.INDEX_NAME,
    DECODE(C.CONSTRAINT_TYPE, 'P', 'PK', 'IDX') AS INDEX_TYPE,
    I.UNIQUENESS,
    LISTAGG(IC.COLUMN_NAME, ', ') WITHIN GROUP (ORDER BY IC.COLUMN_POSITION) AS COLUMNS
FROM USER_INDEXES I
JOIN USER_IND_COLUMNS IC ON I.INDEX_NAME = IC.INDEX_NAME
LEFT JOIN USER_CONSTRAINTS C ON I.INDEX_NAME = C.CONSTRAINT_NAME AND C.CONSTRAINT_TYPE = 'P'
WHERE I.TABLE_NAME IN (
    'TA_FARM', 'TA_MEMBER',
    'TB_MODON', 'TB_MODON_WK', 'TB_GYOBAE', 'TB_BUNMAN', 'TB_EU', 'TB_SAGO', 'TB_MODON_JADON_TRANS',
    'TC_FARM_CONFIG', 'TM_LPD_DATA',
    'TS_INS_MASTER', 'TS_INS_WEEK', 'TS_INS_WEEK_SUB', 'TS_INS_JOB_LOG'
)
GROUP BY I.TABLE_NAME, I.INDEX_NAME, C.CONSTRAINT_TYPE, I.UNIQUENESS
ORDER BY I.TABLE_NAME, INDEX_TYPE DESC, I.INDEX_NAME;

-- 3. 테이블 코멘트 추출
SELECT TABLE_NAME, COMMENTS
FROM USER_TAB_COMMENTS
WHERE TABLE_NAME IN (
    'TA_FARM', 'TA_MEMBER',
    'TB_MODON', 'TB_MODON_WK', 'TB_GYOBAE', 'TB_BUNMAN', 'TB_EU', 'TB_SAGO', 'TB_MODON_JADON_TRANS',
    'TC_FARM_CONFIG', 'TM_LPD_DATA',
    'TS_INS_MASTER', 'TS_INS_WEEK', 'TS_INS_WEEK_SUB', 'TS_INS_JOB_LOG'
)
ORDER BY TABLE_NAME;

-- 4. 컬럼 코멘트 추출
SELECT TABLE_NAME, COLUMN_NAME, COMMENTS
FROM USER_COL_COMMENTS
WHERE TABLE_NAME IN (
    'TA_FARM', 'TA_MEMBER',
    'TB_MODON', 'TB_MODON_WK', 'TB_GYOBAE', 'TB_BUNMAN', 'TB_EU', 'TB_SAGO', 'TB_MODON_JADON_TRANS',
    'TC_FARM_CONFIG', 'TM_LPD_DATA',
    'TS_INS_MASTER', 'TS_INS_WEEK', 'TS_INS_WEEK_SUB', 'TS_INS_JOB_LOG'
)
AND COMMENTS IS NOT NULL
ORDER BY TABLE_NAME, COLUMN_NAME;
```

---

## 11. 예정작업 설정 테이블

### TB_PLAN_MODON (예정작업 설정)

```
PK: FARM_NO, SEQ
용도: 농장별 예정작업 설정 (예정돈 조회 시 PASS_DAY 참조)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| FARM_NO | NUMBER | Y | 농장번호 |
| SEQ | NUMBER | Y | 일련번호 |
| WK_NM | VARCHAR2 | Y | 작업명 |
| STD_CD | VARCHAR2 | Y | 기준작업코드 (020002=전입, 020003=교배, 020004=분만, 020005=이유, 020007=사고) |
| PASS_DAY | NUMBER | Y | 경과일수 |
| MODON_STATUS_CD | VARCHAR2 | Y | 대상 모돈상태 (010001~010008) |
| JOB_GUBUN_CD | VARCHAR2 | Y | 예정작업유형 (150001~150004) |
| BIGO | VARCHAR2 | Y | 비고 |
| USE_YN | CHAR | Y | 사용여부 |
| LOG_INS_DT | DATE | Y | 생성일 |
| LOG_UPT_DT | DATE | Y | 수정일 |
| LOG_INS_ID | VARCHAR2 | Y | 생성자 |
| LOG_UPT_ID | VARCHAR2 | Y | 수정자 |
| HCODE | NUMBER | Y | 백신코드 (TC_CODE_JOHAP 참조) |
| MOBILE | VARCHAR2 | Y | 모바일 |
| BF_PASS_YN | VARCHAR2 | Y | 이전경과 포함여부 (Y=이전 경과일 포함) |
| S_SANCHA | NUMBER | Y | 시작산차 |
| E_SANCHA | NUMBER | Y | 종료산차 |

### 주요 예정작업 설정 예시

| SEQ | WK_NM | STD_CD | PASS_DAY | MODON_STATUS_CD | JOB_GUBUN_CD | 설명 |
|-----|-------|--------|----------|-----------------|--------------|------|
| 1 | 임신감정1차 | 020003 | 21 | 010002 | 150001 | 교배 후 21일 → 임신진단 |
| 2 | 임신감정2차 | 020003 | 42 | 010002 | 150001 | 교배 후 42일 → 임신진단 |
| 3 | 분만예정돈이동 | 020003 | 107 | 010002 | 150002 | 교배 후 107일 → 분만사 이동 |
| 4 | 분만예정돈 | 020003 | 114 | 010002 | 150002 | 교배 후 114일 → 분만 예정 |
| 5 | 후보교배 | 020002 | 60 | 010001 | 150005 | 전입 후 60일 → 교배 대기 |
| 6 | 이유후교배 | 020005 | 3 | 010005 | 150005 | 이유 후 3일 → 교배 대기 |
| 7 | 사고후교배 | 020007 | 0 | 010006 | 150005 | 사고 후 0일 → 교배 대기 |
| 8 | 이유예정돈 | 020004 | 21 | 010003 | 150003 | 분만 후 21일 → 이유 예정 |

### STD_CD (기준작업코드) 의미

| STD_CD | 의미 | 예정일 계산 |
|--------|------|-------------|
| 020002 | 전입 기준 | IN_DT + PASS_DAY |
| 020003 | 교배 기준 | 마지막 교배일 + PASS_DAY |
| 020004 | 분만 기준 | 마지막 분만일 + PASS_DAY |
| 020005 | 이유 기준 | 마지막 이유일 + PASS_DAY |
| 020007 | 사고 기준 | 마지막 사고일 + PASS_DAY |

### ETL에서 사용

```sql
-- 농장별 예정작업 설정 조회
SELECT FARM_NO, SEQ, WK_NM, STD_CD, PASS_DAY, MODON_STATUS_CD, JOB_GUBUN_CD
FROM TB_PLAN_MODON
WHERE FARM_NO = :P_FARM_NO
  AND USE_YN = 'Y'
ORDER BY JOB_GUBUN_CD, SEQ;

-- 기본 설정이 없는 경우 기본값 사용
-- 임신기간: 114일 (TC_FARM_CONFIG.901001)
-- 포유기간: 21일 (TC_FARM_CONFIG.901002)
-- 이유후대기: 7일 (TC_FARM_CONFIG.901003)
```

---

## 12. 카카오/SMS 발송 로그 테이블

### TA_KAKAOMSG_SENT (카카오/SMS 발송 로그)

```
PK: ID
용도: 카카오 알림톡 및 SMS 발송 로그 저장
인덱스:
  - PK_TA_KAKAOMSG_SENT (ID) - UNIQUE (PK)
  - IDX_TA_KAKAOMSG_SENT_01 (GROUPID, MESSAGEID)
  - IDX_TA_KAKAOMSG_SENT_02 (MESSAGEID)
  - IDX_TA_KAKAOMSG_SENT_03 (MSG_GB, CREATEDAT, FARM_NO) - 신규 추가 (일별/농장별 통계용)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| ID | NUMBER | NOT NULL | 일련번호 (PK, SEQ_KAKAOMSG) |
| CREATEDAT | DATE | NOT NULL | 전송시간 |
| UPDATEDAT | DATE | | 전송결과검증시간 |
| SCHEDULEDAT | DATE | | 스케줄예약시간 |
| TO_TEL | VARCHAR2(20) | | 수신번호 |
| FROM_TEL | VARCHAR2(20) | | 발신번호 |
| GROUPID | VARCHAR2(255) | | Solapi 그룹 ID |
| MESSAGEID | VARCHAR2(255) | | Solapi 메시지 ID |
| STATUS | VARCHAR2(20) | | 전송상태 (SENDING, SUCCESS, FAILED) |
| STATUSCODE | VARCHAR2(255) | | 전송결과코드 (2000, 3000, 4000 등) |
| STATUSMESSAGE | VARCHAR2(4000) | | 전송결과메시지 |
| PAYLOAD | CLOB | | 전송내용 (JSON) |
| RESULT | CLOB | | 전송결과내용 (JSON) |
| SENT | VARCHAR2(1) | | 발송여부 (기본값 '0') |
| CERTIFIED_KEY | VARCHAR2(10) | | 인증번호 |
| CERTIFIED_OK | VARCHAR2(1) | | 버튼 인증확인 등 |
| FARM_NO | NUMBER | | 농장번호 **(신규 추가)** |
| MSG_GB | VARCHAR2(20) | | 메시지구분 **(신규 추가)** |

**MSG_GB (메시지구분) 코드:**

| 코드 | 설명 |
|------|------|
| GRADE | 등급판정결과 연계 인증 |
| INSPIG_WEEK | 인사이트피그 주간리포트 |

**상태코드 (STATUSCODE):**

| 코드 | 설명 |
|------|------|
| 2000 | 정상 접수 (이통사 접수 예정) |
| 3000 | 이통사 접수 (리포트 대기) |
| 4000 | 수신 완료 |
| 기타 | 오류 |

**신규 컬럼 추가 DDL:**

```sql
-- 농장번호 및 메시지구분 컬럼 추가
ALTER TABLE TA_KAKAOMSG_SENT ADD FARM_NO NUMBER;
ALTER TABLE TA_KAKAOMSG_SENT ADD MSG_GB VARCHAR2(20);

COMMENT ON COLUMN TA_KAKAOMSG_SENT.FARM_NO IS '농장번호';
COMMENT ON COLUMN TA_KAKAOMSG_SENT.MSG_GB IS '메시지구분 (GRADE:등급판정, INSPIG_WEEK:인사이트피그주간)';

-- 인덱스 추가 (일별/농장별 통계용)
CREATE INDEX IDX_TA_KAKAOMSG_SENT_03 ON TA_KAKAOMSG_SENT (MSG_GB, CREATEDAT, FARM_NO);
```

**일별/농장별 발송 통계 쿼리:**

```sql
-- 일별 발송 통계 (인사이트피그)
SELECT
    TRUNC(CREATEDAT) AS SEND_DATE,
    COUNT(*) AS TOTAL_CNT,
    SUM(CASE WHEN STATUSCODE IN ('2000', '3000', '4000') THEN 1 ELSE 0 END) AS SUCCESS_CNT,
    SUM(CASE WHEN STATUSCODE NOT IN ('2000', '3000', '4000') THEN 1 ELSE 0 END) AS FAIL_CNT
FROM TA_KAKAOMSG_SENT
WHERE MSG_GB = 'INSPIG_WEEK'
  AND CREATEDAT >= TRUNC(SYSDATE) - 30
GROUP BY TRUNC(CREATEDAT)
ORDER BY SEND_DATE DESC;

-- 농장별 발송 통계 (인사이트피그)
SELECT
    FARM_NO,
    COUNT(*) AS TOTAL_CNT,
    SUM(CASE WHEN STATUSCODE IN ('2000', '3000', '4000') THEN 1 ELSE 0 END) AS SUCCESS_CNT,
    SUM(CASE WHEN STATUSCODE NOT IN ('2000', '3000', '4000') THEN 1 ELSE 0 END) AS FAIL_CNT,
    MAX(CREATEDAT) AS LAST_SEND_DT
FROM TA_KAKAOMSG_SENT
WHERE MSG_GB = 'INSPIG_WEEK'
GROUP BY FARM_NO
ORDER BY FARM_NO;

-- 일별/농장별 발송 통계 (크로스탭)
SELECT
    TRUNC(CREATEDAT) AS SEND_DATE,
    FARM_NO,
    COUNT(*) AS CNT,
    MAX(STATUSCODE) AS STATUSCODE
FROM TA_KAKAOMSG_SENT
WHERE MSG_GB = 'INSPIG_WEEK'
  AND CREATEDAT >= TRUNC(SYSDATE) - 7
GROUP BY TRUNC(CREATEDAT), FARM_NO
ORDER BY SEND_DATE DESC, FARM_NO;
```

**로그 조회 예시:**

```sql
-- 인사이트피그 주간리포트 발송 로그 조회
SELECT ID, CREATEDAT, TO_TEL, FARM_NO, STATUS, STATUSCODE, STATUSMESSAGE
FROM TA_KAKAOMSG_SENT
WHERE MSG_GB = 'INSPIG_WEEK'
  AND CREATEDAT >= SYSDATE - 7
ORDER BY ID DESC;

-- 등급판정 발송 로그 조회
SELECT ID, CREATEDAT, TO_TEL, STATUS, STATUSCODE, CERTIFIED_KEY, CERTIFIED_OK
FROM TA_KAKAOMSG_SENT
WHERE MSG_GB = 'GRADE'
  AND CREATEDAT >= SYSDATE - 7
ORDER BY ID DESC;

-- 발송 실패 건 조회
SELECT *
FROM TA_KAKAOMSG_SENT
WHERE STATUSCODE NOT IN ('2000', '3000', '4000')
  AND CREATEDAT >= SYSDATE - 7;
```

---

## 13. 날씨 데이터 테이블

### TM_WEATHER_ASOS (ASOS 관측소 메타정보)

```
PK: STN_ID
용도: ASOS(종관기상관측) 관측소 메타정보 (97개 관측소)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| STN_ID | INTEGER | NOT NULL | 관측소 지점번호 (PK) |
| STN_NM | VARCHAR2(50) | NOT NULL | 관측소명 |
| LAT | NUMBER(9,6) | NOT NULL | 위도 |
| LON | NUMBER(9,6) | NOT NULL | 경도 |
| ALTITUDE | NUMBER(6,1) | | 고도 (m) |
| USE_YN | CHAR(1) | | 사용여부 (기본값 'Y') |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_UPT_DT | DATE | | 수정일 |

**참고:**
- ASOS 관측소는 전국 97개 지점
- 농장에서 가장 가까운 관측소 계산에 Haversine 공식 사용
- 계산된 관측소는 TA_FARM.ASOS_STN_ID에 캐싱

### TM_WEATHER (일별 날씨)

```
PK: WEATHER_DATE, NX, NY
용도: 농장별 일별 날씨 데이터 (예보/실측)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| WEATHER_DATE | VARCHAR2(8) | NOT NULL | 날짜 (YYYYMMDD, PK) |
| NX | NUMBER(4) | NOT NULL | 기상청 격자 X (PK) |
| NY | NUMBER(4) | NOT NULL | 기상청 격자 Y (PK) |
| TMP_MIN | NUMBER(5,1) | | 최저기온 (℃) |
| TMP_MAX | NUMBER(5,1) | | 최고기온 (℃) |
| POP | NUMBER(3) | | 강수확률 (%) |
| REH | NUMBER(3) | | 습도 (%) |
| IS_FORECAST | CHAR(1) | | 예보여부 (Y:예보, N:실측) |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_UPT_DT | DATE | | 수정일 |

### TM_WEATHER_HOURLY (시간별 날씨)

```
PK: WEATHER_DATE, WEATHER_TIME, NX, NY
용도: 농장별 시간별 날씨 데이터 (예보/실측)
```

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| WEATHER_DATE | VARCHAR2(8) | NOT NULL | 날짜 (YYYYMMDD, PK) |
| WEATHER_TIME | VARCHAR2(4) | NOT NULL | 시간 (HHMM, PK) |
| NX | NUMBER(4) | NOT NULL | 기상청 격자 X (PK) |
| NY | NUMBER(4) | NOT NULL | 기상청 격자 Y (PK) |
| TMP | NUMBER(5,1) | | 기온 (℃) |
| POP | NUMBER(3) | | 강수확률 (%) |
| REH | NUMBER(3) | | 습도 (%) |
| WSD | NUMBER(5,1) | | 풍속 (m/s) |
| IS_FORECAST | CHAR(1) | | 예보여부 (Y:예보, N:실측) |
| LOG_INS_DT | DATE | | 생성일 |
| LOG_UPT_DT | DATE | | 수정일 |

**날씨 데이터 수집 방식:**

| 데이터 | API | IS_FORECAST | 설명 |
|--------|-----|-------------|------|
| 단기예보 | getVilageFcst | Y | 오늘~+3일 예보 (격자 기반) |
| 초단기실황 | getUltraSrtNcst | N | 현재 시각 실측 (격자 기반) |
| ASOS 일자료 | AsosDalyInfoService | N | 최근 7일 실측 (관측소 기반) |

---

## 관련 문서

- [02.view.md](02.view.md) - VW_MODON_DATE_2020_MAX_WK
- [03.function.md](03.function.md) - SF_GET_MODONGB_STATUS, TC_CODE_SYS 코드 참조
